---
title: Модули
date: 2025-03-23 15:00:00
showTableOfContents: true
showComments: true
katex: true
tags:
  - zig
  - zigbook
  - module
---

Редко какой проект можно уместить в один файл. Хотя мне доводилось встречать программы, где основной файл содержал 10 000 строк кода, это считается плохой практикой. Обычно любое более-менее серьезное приложение разбивается на модули.

Разбиение кода на модули помогает:
* Улучшить его структуру, делая программу более организованной.
* Упростить чтение и поддержку, что особенно важно при работе в команде.
* Ускорить компиляцию и выполнение программы, так как изменения затрагивают только отдельные модули, а не весь код целиком.

Кроме того, модульность дает возможность переиспользовать код — как в разных частях одного приложения, так и в других проектах. Это значительно облегчает разработку и снижает количество дублируемого кода.

В языке Zig концепция модулей предельно проста, что соответствует основным принципам, которым следует сообщество разработчиков при его создании.

## Модули в Zig
Любой файл с расширение `.zig` является модулем в языке Zig. В языке нет каких то специальных механизмов или ключевых слов для объявления модулей. Вся работа с модулями строится всего на трех ключевых словах - `pub`, `import` и `usingnamespace`. При этом для создания иерархии модулей используется иерархия папок и файлов на уровне файловой системы. Каждый файл на диске с расширением `.zig` может быть импортирован в другой файл с помощью ключевого слова `import`. При этом, при импорте файла компилятор превратит содержимое импортируемого файла в структуру с именем, равным имени файла без расширения. Например, если вы импортируете файл `math.zig`, то компилятор создаст структуру с именем `math`. Давайте расмотрим пример простого импорта:

```zig
// Файл math.zig

const MAX = 100;

pub fn add(a: i32, b: i32) i32 {
    return a + b;
}

// Файл main.zig
const math = @import("math.zig");

pub fn main() void {
    math.add(2, 3);
}
```

В этом примере мы импортируем модуль `math.zig` в файл `main.zig`. Компилятор создаст структуру с именем `math`, которая будет содержать все публичные функции и константы из файла `math.zig`. Мы можем использовать эти функции и константы в файле `main.zig` с помощью синтаксиса `math.add(2, 3)`. Функция `@import` принимает всего один параметр, который может быть либо относительным или абсолютным путем к импортированному файлу, либо именем модуля. На текущий момент в Zig поддерживается три модуля, которые вы можете импортировать по имени - `std`, `builtin` и `root`:

* **std**:
  Данный модуль представляет из себе стандартную библиотеку языка Zig, которая содержит множество полезных функций и структур данных. Она включает в себя модули для работы с файлами, сетью, потоками, а также содержит множество полезных функций для работы с числами, строками и массивами. Мы неоднократно уже импортировали различные части стандартной библиотеки, например, модуль `std.debug` для вывода отладочной информации в консоль, модуль `std.io` для работы с файлами и потоками и модуль `std.mem` для работы с памятью.
* **builtin**:
  Данный модуль различные переменные, которые могут быть полезны при компиляции вашего кода, такие как архитектура платформы, информация о процессоре, версия Zig и т.д.
* **root**:
  Данный модуль представляет из себе корневой модуль языка Zig, например если мы разрабатываем библиотеку, то импорт `root` вернет нам корневой модуль нашей библиотеки, если мы разрабатываем приложение, то импорт `root` вернет нам корневой модуль нашего приложения.

При импортировании нашего модуля мы задаем имя, которое будет использоваться для доступа к функциям и переменным в этом модуле. Например, если мы импортируем модуль `math.zig` и задаем имя `math`, то мы можем использовать функции и переменные из этого модуля с помощью синтаксиса `math.add(2, 3)`.

Если имя вашего импортируемого модуля состоит из нескольких слов, то приянто разделять слова символом `_`, например `my_module.zig` импортируется как `my_module`.

## Доступ к элементам модуля
Для того чтобы получить доступ к элементам импортированного модуля, этот элемент должен быть помечен ключевым словом `pub`. Если попытаться импортировать импортировать элемент который не помечен ключевым словом `pub`, то будет выдано сообщение об ошибке:

```zig
// Файл user.zig

const Animal = struct {
    name: []u8,
};

// Фалй main.zig
const std = @import("std");
const user_module = @import("user.zig");

pub fn main() !void {
    const user = user_module.User{
        .name = "John Doe",
    };
    std.debug.print("User: {s}\n", .{user.name});

    const animal = user_module.Animal{
        .name = "Dog",
    };
    std.debug.print("Animal: {s}\n", .{animal.name});
}
```

Если мы попробуем скомпилировать нашу программу, то получим ошибку:

```
run
└─ run simple
   └─ install
      └─ install simple
         └─ zig build-exe simple Debug native 1 errors
src/main.zig:10:31: error: 'Animal' is not marked 'pub'
    const animal = user_module.Animal{
                   ~~~~~~~~~~~^~~~~~~
```

Компилятор говорит нам, что не может импортировать элемент `Animal` из модуля `user.zig`, так как он не помечен ключевым словом `pub`.

## usingnamespace
